/*
    Target database:    ContosoUniversityRefactor (configurable)
    Target instance:    (any)
    Generated date:     12/5/2019 12:24:54 PM
    Generated on:       
    Package version:    (undefined)
    Migration version:  (n/a)
    Baseline version:   (n/a)
    SQL Change Automation version:  4.1.19324.13560
    Migrations pending: (variable)

    IMPORTANT! "SQLCMD Mode" must be activated prior to execution (under the Query menu in SSMS).

    BEFORE EXECUTING THIS SCRIPT, WE STRONGLY RECOMMEND YOU TAKE A BACKUP OF YOUR DATABASE.

    This SQLCMD script is designed to be executed through MSBuild (via the .sqlproj Deploy target) however
    it can also be run manually using SQL Management Studio.

    It was generated by the SQL Change Automation build task and contains logic to deploy the database, ensuring that
    each of the incremental migrations is executed a single time only in alphabetical (filename)
    order. If any errors occur within those scripts, the deployment will be aborted and the transaction
    rolled-back.

    NOTE: Automatic transaction management is provided for incremental migrations, so you don't need to
          add any special BEGIN TRAN/COMMIT/ROLLBACK logic in those script files.
          However if you require transaction handling in your Pre/Post-Deployment scripts, you will
          need to add this logic to the source .sql files yourself.
*/

----====================================================================================================================
---- SQLCMD Variables
---- This script is designed to be called by SQLCMD.EXE with variables specified on the command line.
---- However you can also run it in SQL Management Studio by uncommenting this section (CTRL+K, CTRL+U).
:setvar DatabaseName "ContosoUniversity"
:setvar ReleaseVersion ""
:setvar ForceDeployWithoutBaseline "False"
:setvar DefaultFilePrefix "ContosoUniversity"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""
:setvar DefaultBackupPath ""
:setvar DeployPath ""
----====================================================================================================================

:on error exit -- Instructs SQLCMD to abort execution as soon as an erroneous batch is encountered

:setvar PackageVersion "(undefined)"
:setvar IsShadowDeployment 0

GO
:setvar IsSqlCmdEnabled "True"
GO

IF N'$(DatabaseName)' = N'$' + N'(DatabaseName)' OR
   N'$(ReleaseVersion)' = N'$' + N'(ReleaseVersion)' OR
   N'$(ForceDeployWithoutBaseline)' = N'$' + N'(ForceDeployWithoutBaseline)'
      RAISERROR('(This will not throw). Please make sure that all SQLCMD variables are defined before running this script.', 0, 0);
GO

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;
SET XACT_ABORT ON; -- Abort the current batch immediately if a statement raises a run-time error and rollback any open transaction(s)

IF N'$(IsSqlCmdEnabled)' <> N'True' -- Is SQLCMD mode not enabled within the execution context (eg. SSMS)
    BEGIN
        IF IS_SRVROLEMEMBER(N'sysadmin') = 1
            BEGIN -- User is sysadmin; abort execution by disconnect the script from the database server
                RAISERROR(N'This script must be run in SQLCMD Mode (under the Query menu in SSMS). Aborting connection to suppress subsequent errors.', 20, 127, N'UNKNOWN') WITH LOG;
            END
        ELSE
            BEGIN -- User is not sysadmin; abort execution by switching off statement execution (script will continue to the end without performing any actual deployment work)
                RAISERROR(N'This script must be run in SQLCMD Mode (under the Query menu in SSMS). Script execution has been halted.', 16, 127, N'UNKNOWN') WITH NOWAIT;
            END
    END
GO
IF @@ERROR != 0
    BEGIN
        SET NOEXEC ON; -- SQLCMD is NOT enabled so prevent any further statements from executing
    END
GO
-- Beyond this point, no further explicit error handling is required because it can be assumed that SQLCMD mode is enabled

IF SERVERPROPERTY('EngineEdition') = 5 AND DB_NAME() != N'$(DatabaseName)'
  RAISERROR(N'Azure SQL Database does not support switching between databases. Connect to [$(DatabaseName)] and then re-run the script.', 16, 127);








------------------------------------------------------------------------------------------------------------------------
------------------------------------------       PRE-DEPLOYMENT SCRIPTS       ------------------------------------------
------------------------------------------------------------------------------------------------------------------------

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

PRINT '----- executing pre-deployment script "Pre-Deployment\01_Create_Database.sql" -----';
GO

------------------------- BEGIN PRE-DEPLOYMENT SCRIPT: "Pre-Deployment\01_Create_Database.sql" ---------------------------
IF (DB_ID(N'$(DatabaseName)') IS NULL)
BEGIN
	PRINT N'Creating $(DatabaseName)...';
END
GO
IF (DB_ID(N'$(DatabaseName)') IS NULL)
BEGIN
	CREATE DATABASE [$(DatabaseName)]; -- MODIFY THIS STATEMENT TO SPECIFY A COLLATION FOR YOUR DATABASE
END

GO
-------------------------- END PRE-DEPLOYMENT SCRIPT: "Pre-Deployment\01_Create_Database.sql" ----------------------------

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;









------------------------------------------------------------------------------------------------------------------------
------------------------------------------       INCREMENTAL MIGRATIONS       ------------------------------------------
------------------------------------------------------------------------------------------------------------------------

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
PRINT '# Beginning transaction';

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

SET XACT_ABORT ON;

BEGIN TRANSACTION;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
PRINT '# Setting up migration log table';
IF (NOT EXISTS (SELECT * FROM sys.objects WHERE [object_id] = OBJECT_ID(N'[dbo].[__MigrationLog]') AND [type] = 'U'))
  BEGIN
    IF OBJECT_ID(N'[dbo].[__MigrationLogCurrent]', 'V') IS NOT NULL
      DROP VIEW [dbo].[__MigrationLogCurrent];
    PRINT '# Creating a new migration log table';
    CREATE TABLE [dbo].[__MigrationLog] (
      [migration_id] UNIQUEIDENTIFIER NOT NULL,
      [script_checksum] NVARCHAR (64) NOT NULL,
      [script_filename] NVARCHAR (255) NOT NULL,
      [complete_dt] DATETIME2 NOT NULL,
      [applied_by] NVARCHAR (100) NOT NULL,
      [deployed] TINYINT CONSTRAINT [DF___MigrationLog_deployed] DEFAULT (1) NOT NULL,
      [version] VARCHAR (255) NULL,
      [package_version] VARCHAR (255) NULL,
      [release_version] VARCHAR (255) NULL,
      [sequence_no] INT IDENTITY (1, 1) NOT NULL CONSTRAINT [PK___MigrationLog] PRIMARY KEY CLUSTERED ([migration_id], [complete_dt], [script_checksum]));
    CREATE NONCLUSTERED INDEX [IX___MigrationLog_CompleteDt]
      ON [dbo].[__MigrationLog]([complete_dt]);
    CREATE NONCLUSTERED INDEX [IX___MigrationLog_Version]
      ON [dbo].[__MigrationLog]([version]);
    CREATE UNIQUE NONCLUSTERED INDEX [UX___MigrationLog_SequenceNo]
      ON [dbo].[__MigrationLog]([sequence_no]);
    EXECUTE ('
	CREATE VIEW [dbo].[__MigrationLogCurrent]
			AS
			WITH currentMigration AS
			(
			  SELECT
				 migration_id, script_checksum, script_filename, complete_dt, applied_by, deployed, ROW_NUMBER() OVER(PARTITION BY migration_id ORDER BY sequence_no DESC) AS RowNumber
			  FROM [dbo].[__MigrationLog]
			)
			SELECT  migration_id, script_checksum, script_filename, complete_dt, applied_by, deployed
			FROM currentMigration
			WHERE RowNumber = 1
	');
    IF OBJECT_ID(N'sp_addextendedproperty', 'P') IS NOT NULL
      BEGIN
        PRINT N'Creating extended properties';
        EXECUTE sp_addextendedproperty N'MS_Description', N'This table is required by SQL Change Automation projects to keep track of which migrations have been executed during deployment. Please do not alter or remove this table from the database.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', NULL, NULL;
        EXECUTE sp_addextendedproperty N'MS_Description', N'The executing user at the time of deployment (populated using the SYSTEM_USER function).', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'applied_by';
        EXECUTE sp_addextendedproperty N'MS_Description', N'The date/time that the migration finished executing. This value is populated using the SYSDATETIME function.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'complete_dt';
        EXECUTE sp_addextendedproperty N'MS_Description', N'This column contains a number of potential states:

0 - Marked As Deployed: The migration was not executed.
1- Deployed: The migration was executed successfully.
2- Imported: The migration was generated by importing from this DB.

"Marked As Deployed" and "Imported" are similar in that the migration was not executed on this database; it was was only marked as such to prevent it from executing during subsequent deployments.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'deployed';
        EXECUTE sp_addextendedproperty N'MS_Description', N'The unique identifier of a migration script file. This value is stored within the <Migration /> Xml fragment within the header of the file itself.

Note that it is possible for this value to repeat in the [__MigrationLog] table. In the case of programmable object scripts, a record will be inserted with a particular ID each time a change is made to the source file and subsequently deployed.

In the case of a migration, you may see the same [migration_id] repeated, but only in the scenario where the "Mark As Deployed" button/command has been run.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'migration_id';
        EXECUTE sp_addextendedproperty N'MS_Description', N'If you have enabled SQLCMD Packaging in your SQL Change Automation project, or if you are using Octopus Deploy, this will be the version number that your database package was stamped with at build-time.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'package_version';
        EXECUTE sp_addextendedproperty N'MS_Description', N'If you are using Octopus Deploy, you can use the value in this column to look-up which release was responsible for deploying this migration.
If deploying via PowerShell, set the $ReleaseVersion variable to populate this column.
If deploying via Visual Studio, this column will always be NULL.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'release_version';
        EXECUTE sp_addextendedproperty N'MS_Description', N'A SHA256 representation of the migration script file at the time of build.  This value is used to determine whether a migration has been changed since it was deployed. In the case of a programmable object script, a different checksum will cause the migration to be redeployed.
Note: if any variables have been specified as part of a deployment, this will not affect the checksum value.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'script_checksum';
        EXECUTE sp_addextendedproperty N'MS_Description', N'The name of the migration script file on disk, at the time of build.
If Semantic Versioning has been enabled, then this value will contain the full relative path from the root of the project folder. If it is not enabled, then it will simply contain the filename itself.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'script_filename';
        EXECUTE sp_addextendedproperty N'MS_Description', N'An auto-seeded numeric identifier that can be used to determine the order in which migrations were deployed.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'sequence_no';
        EXECUTE sp_addextendedproperty N'MS_Description', N'The semantic version that this migration was created under. In SQL Change Automation projects, a folder can be given a version number, e.g. 1.0.0, and one or more migration scripts can be stored within that folder to provide logical grouping of related database changes.', 'SCHEMA', N'dbo', 'TABLE', N'__MigrationLog', 'COLUMN', N'version';
        EXECUTE sp_addextendedproperty N'MS_Description', N'This view is required by SQL Change Automation projects to determine whether a migration should be executed during a deployment. The view lists the most recent [__MigrationLog] entry for a given [migration_id], which is needed to determine whether a particular programmable object script needs to be (re)executed: a non-matching checksum on the current [__MigrationLog] entry will trigger the execution of a programmable object script. Please do not alter or remove this table from the database.', N'SCHEMA', N'dbo', N'VIEW', N'__MigrationLogCurrent', NULL, NULL;
      END
  END

IF NOT EXISTS (SELECT col.COLUMN_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS tab, INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE AS col WHERE col.CONSTRAINT_NAME = tab.CONSTRAINT_NAME AND col.TABLE_NAME = tab.TABLE_NAME AND col.TABLE_SCHEMA = tab.TABLE_SCHEMA AND tab.CONSTRAINT_TYPE = 'PRIMARY KEY' AND col.TABLE_SCHEMA = 'dbo' AND col.TABLE_NAME = '__MigrationLog' AND col.COLUMN_NAME = 'complete_dt')
  BEGIN
    RAISERROR (N'The SQL Change Automation [dbo].[__MigrationLog] table has an incorrect primary key specification. This may be due to the fact that the <SqlChangeAutomationSchemaVersion/> element in your .sqlproj file contains the wrong version number for your database. Please check earlier versions of your .sqlproj file to determine what is the appropriate version for your database (possibly 1.7 or 1.3.1).', 16, 127, N'UNKNOWN')
      WITH NOWAIT;
    RETURN;
  END

IF COL_LENGTH(N'[dbo].[__MigrationLog]', N'sequence_no') IS NULL
  BEGIN
    RAISERROR (N'The SQL Change Automation [dbo].[__MigrationLog] table is missing the [sequence_no] column. This may be due to the fact that the <SqlChangeAutomationSchemaVersion/> element in your .sqlproj file contains the wrong version number for your database. Please check earlier versions of your .sqlproj file to determine what is the appropriate version for your database (possibly 1.7 or 1.3.1).', 16, 127, N'UNKNOWN')
      WITH NOWAIT;
    RETURN;
  END

IF (NOT EXISTS (SELECT * FROM sys.objects WHERE [object_id] = OBJECT_ID(N'[dbo].[__MigrationLogCurrent]') AND [type] = 'V'))
  BEGIN
    EXECUTE ('
	CREATE VIEW [dbo].[__MigrationLogCurrent]
			AS
			WITH currentMigration AS
			(
			  SELECT
				 migration_id, script_checksum, script_filename, complete_dt, applied_by, deployed, ROW_NUMBER() OVER(PARTITION BY migration_id ORDER BY sequence_no DESC) AS RowNumber
			  FROM [dbo].[__MigrationLog]
			)
			SELECT  migration_id, script_checksum, script_filename, complete_dt, applied_by, deployed
			FROM currentMigration
			WHERE RowNumber = 1
	');
  END

GO
PRINT '# Setting up __SchemaSnapshot table';
IF (NOT EXISTS (SELECT * FROM sys.objects WHERE [object_id] = OBJECT_ID(N'[dbo].[__SchemaSnapshot]')))
  BEGIN
    CREATE TABLE [dbo].[__SchemaSnapshot] (
      [Snapshot] VARBINARY (MAX),
      [LastUpdateDate] DATETIME2 CONSTRAINT [__SchemaSnapshotDateDefault] DEFAULT SYSDATETIME());
    IF OBJECT_ID(N'sp_addextendedproperty', 'P') IS NOT NULL
      BEGIN
        EXECUTE sp_addextendedproperty N'MS_Description', N'This table is used by SQL Change Automation projects to store a snapshot of the schema at the time of the last deployment. Please do not alter or remove this table from the database.', 'SCHEMA', N'dbo', 'TABLE', N'__SchemaSnapshot', NULL, NULL;
      END
  END

GO
PRINT '# Truncating __SchemaSnapshot';
TRUNCATE TABLE [dbo].[__SchemaSnapshot];

GO
PRINT '# Check if baseline is required';
DECLARE @baselineRequired AS BIT;

SET @baselineRequired = 0;

IF (EXISTS (SELECT * FROM sys.objects AS o WHERE o.is_ms_shipped = 0 AND NOT (o.name LIKE '%__MigrationLog%' OR o.name LIKE '%__SchemaSnapshot%')) AND (SELECT count(*) FROM [dbo].[__MigrationLog]) = 0)
  SET @baselineRequired = 1;

IF @baselineRequired = 1
  BEGIN
    PRINT '----- baselined: Migrations\1.0.0-Baseline\00001_20190906_1000_BASELINE.sql (marked as deployed) -----';
    INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
    VALUES                                         (CAST ('2dcd84e2-bf07-48c6-bfc8-5c92b6a84a3b' AS UNIQUEIDENTIFIER), 'D411EABEBAB24CDE0C4470CCFA14B10FA2E2BD067363A868044467A839D43394', 'Migrations\1.0.0-Baseline\00001_20190906_1000_BASELINE.sql', SYSDATETIME(), SYSTEM_USER, 0, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);
  END

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('2dcd84e2-bf07-48c6-bfc8-5c92b6a84a3b' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\1.0.0-Baseline\00001_20190906_1000_BASELINE.sql", ID: {2dcd84e2-bf07-48c6-bfc8-5c92b6a84a3b} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('2dcd84e2-bf07-48c6-bfc8-5c92b6a84a3b' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\1.0.0-Baseline\00001_20190906_1000_BASELINE.sql", ID: {2dcd84e2-bf07-48c6-bfc8-5c92b6a84a3b} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('CREATE TABLE dbo.Department
(
    DepartmentID INT NOT NULL IDENTITY(1, 1)
    ,Name NVARCHAR(50) NULL
    ,Budget MONEY NOT NULL
    ,StartDate DATETIME2 NOT NULL
    ,InstructorID INT NULL
    ,RowVersion TIMESTAMP NULL
);
ALTER TABLE dbo.Department ADD CONSTRAINT PK_Department PRIMARY KEY CLUSTERED (DepartmentID);
CREATE NONCLUSTERED INDEX IX_Department_InstructorID ON dbo.Department (InstructorID);

CREATE TABLE dbo.Course
(
    CourseID INT NOT NULL
    ,Title NVARCHAR(50) NULL
    ,Credits INT NOT NULL
    ,DepartmentID INT NOT NULL CONSTRAINT DF__Course__Departme__3E52440B DEFAULT ((0))
);

ALTER TABLE dbo.Course ADD CONSTRAINT PK_Course PRIMARY KEY CLUSTERED (CourseID);

CREATE NONCLUSTERED INDEX IX_Course_DepartmentID ON dbo.Course (DepartmentID);

CREATE TABLE dbo.CourseAssignment
(
    InstructorID INT NOT NULL
    ,CourseID INT NOT NULL
);

ALTER TABLE dbo.CourseAssignment ADD CONSTRAINT PK_CourseAssignment PRIMARY KEY CLUSTERED
                                         (CourseID, InstructorID);

CREATE NONCLUSTERED INDEX IX_CourseAssignment_InstructorID ON dbo.CourseAssignment (InstructorID);

CREATE TABLE dbo.Instructor
(
    ID INT NOT NULL IDENTITY(1, 1)
    ,LastName NVARCHAR(50) NOT NULL
    ,FirstName NVARCHAR(50) NOT NULL
    ,HireDate DATETIME2 NOT NULL
);

ALTER TABLE dbo.Instructor ADD CONSTRAINT PK_Instructor PRIMARY KEY CLUSTERED (ID);

CREATE TABLE dbo.Enrollment
(
    EnrollmentID INT NOT NULL IDENTITY(1, 1)
    ,CourseID INT NOT NULL
    ,StudentID INT NOT NULL
    ,Grade INT NULL
);

ALTER TABLE dbo.Enrollment ADD CONSTRAINT PK_Enrollment PRIMARY KEY CLUSTERED (EnrollmentID);

CREATE NONCLUSTERED INDEX IX_Enrollment_CourseID ON dbo.Enrollment (CourseID);

CREATE NONCLUSTERED INDEX IX_Enrollment_StudentID ON dbo.Enrollment (StudentID);

CREATE TABLE dbo.Student
(
    ID INT NOT NULL IDENTITY(1, 1)
    ,LastName NVARCHAR(50) NOT NULL
    ,FirstName NVARCHAR(50) NULL
    ,EnrollmentDate DATETIME2 NOT NULL
);

ALTER TABLE dbo.Student ADD CONSTRAINT PK_Student PRIMARY KEY CLUSTERED (ID);

CREATE TABLE dbo.OfficeAssignment
(
    InstructorID INT NOT NULL
    ,Location NVARCHAR(50) NULL
);

ALTER TABLE dbo.OfficeAssignment ADD CONSTRAINT PK_OfficeAssignment PRIMARY KEY CLUSTERED (InstructorID);

CREATE TABLE dbo.__EFMigrationsHistory
(
    MigrationId NVARCHAR(150) NOT NULL
    ,ProductVersion NVARCHAR(32) NOT NULL
);

ALTER TABLE dbo.__EFMigrationsHistory ADD CONSTRAINT PK___EFMigrationsHistory PRIMARY KEY CLUSTERED
                                              (MigrationId);
');

GO
EXECUTE ('
ALTER TABLE dbo.CourseAssignment
ADD CONSTRAINT FK_CourseAssignment_Instructor_InstructorID FOREIGN KEY (InstructorID) REFERENCES dbo.Instructor
                                                             (ID) ON DELETE CASCADE;

ALTER TABLE dbo.CourseAssignment
ADD CONSTRAINT FK_CourseAssignment_Course_CourseID FOREIGN KEY (CourseID) REFERENCES dbo.Course (CourseID) ON DELETE CASCADE;

ALTER TABLE dbo.Enrollment
ADD CONSTRAINT FK_Enrollment_Course_CourseID FOREIGN KEY (CourseID) REFERENCES dbo.Course (CourseID) ON DELETE CASCADE;

ALTER TABLE dbo.Enrollment ADD CONSTRAINT FK_Enrollment_Student_StudentID FOREIGN KEY (StudentID) REFERENCES dbo.Student
                                                                                (ID) ON DELETE CASCADE;

ALTER TABLE dbo.Course
ADD CONSTRAINT FK_Course_Department_DepartmentID FOREIGN KEY (DepartmentID) REFERENCES dbo.Department
                                                   (DepartmentID) ON DELETE CASCADE;

ALTER TABLE dbo.Department ADD CONSTRAINT FK_Department_Instructor_InstructorID FOREIGN KEY (InstructorID) REFERENCES dbo.Instructor
                                                                                      (ID);

ALTER TABLE dbo.OfficeAssignment
ADD CONSTRAINT FK_OfficeAssignment_Instructor_InstructorID FOREIGN KEY (InstructorID) REFERENCES dbo.Instructor
                                                             (ID) ON DELETE CASCADE;
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('2dcd84e2-bf07-48c6-bfc8-5c92b6a84a3b' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\1.0.0-Baseline\00001_20190906_1000_BASELINE.sql", ID: {2dcd84e2-bf07-48c6-bfc8-5c92b6a84a3b} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('2dcd84e2-bf07-48c6-bfc8-5c92b6a84a3b' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('2dcd84e2-bf07-48c6-bfc8-5c92b6a84a3b' AS UNIQUEIDENTIFIER), 'D411EABEBAB24CDE0C4470CCFA14B10FA2E2BD067363A868044467A839D43394', 'Migrations\1.0.0-Baseline\00001_20190906_1000_BASELINE.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('b9b4e2fe-6fff-4875-bc23-0778403e087a' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\1.1.0-Changes\00002_20190913_1112_Refactor_DropForeignKeys.sql", ID: {b9b4e2fe-6fff-4875-bc23-0778403e087a} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('b9b4e2fe-6fff-4875-bc23-0778403e087a' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\1.1.0-Changes\00002_20190913_1112_Refactor_DropForeignKeys.sql", ID: {b9b4e2fe-6fff-4875-bc23-0778403e087a} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('/**************************************************************************
** CREATED BY:   Mick Letofsky
** CREATED DATE: 2019.09.13
** CREATION:     Refactor effort: Drop foreign keys.
**************************************************************************/
IF EXISTS (SELECT 1 FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N''FK_Course_Department_DepartmentID'') AND parent_object_id = OBJECT_ID(N''dbo.Course''))
BEGIN 
	PRINT ''Dropping Foreign Key: FK_Course_Department_DepartmentID''
	ALTER TABLE dbo.Course DROP CONSTRAINT FK_Course_Department_DepartmentID;
END 

IF EXISTS (SELECT 1 FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N''FK_CourseAssignment_Course_CourseID'') AND parent_object_id = OBJECT_ID(N''dbo.CourseAssignment''))
BEGIN 
	PRINT ''Dropping Foreign Key: FK_CourseAssignment_Course_CourseID''
	ALTER TABLE dbo.CourseAssignment DROP CONSTRAINT FK_CourseAssignment_Course_CourseID;
END 

IF EXISTS (SELECT 1 FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N''FK_CourseAssignment_Instructor_InstructorID'') AND parent_object_id = OBJECT_ID(N''dbo.CourseAssignment''))
BEGIN 
	PRINT ''Dropping Foreign Key: FK_CourseAssignment_Instructor_InstructorID''
	ALTER TABLE dbo.CourseAssignment DROP CONSTRAINT FK_CourseAssignment_Instructor_InstructorID;
END 

IF EXISTS (SELECT 1 FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N''FK_Department_Instructor_InstructorID'') AND parent_object_id = OBJECT_ID(N''dbo.Department''))
BEGIN 
	PRINT ''Dropping Foreign Key: FK_Department_Instructor_InstructorID''
	ALTER TABLE dbo.Department DROP CONSTRAINT FK_Department_Instructor_InstructorID;
END 

IF EXISTS (SELECT 1 FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N''FK_Enrollment_Course_CourseID'') AND parent_object_id = OBJECT_ID(N''dbo.Enrollment''))
BEGIN 
	PRINT ''Dropping Foreign Key: FK_Enrollment_Course_CourseID''
	ALTER TABLE dbo.Enrollment DROP CONSTRAINT FK_Enrollment_Course_CourseID;
END 

IF EXISTS (SELECT 1 FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N''FK_Enrollment_Student_StudentID'') AND parent_object_id = OBJECT_ID(N''dbo.Enrollment''))
BEGIN 
	PRINT ''Dropping Foreign Key: FK_Enrollment_Student_StudentID''
	ALTER TABLE dbo.Enrollment DROP CONSTRAINT FK_Enrollment_Student_StudentID;
END 

IF EXISTS (SELECT 1 FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N''FK_OfficeAssignment_Instructor_InstructorID'') AND parent_object_id = OBJECT_ID(N''dbo.OfficeAssignment''))
BEGIN 
	PRINT ''Dropping Foreign Key: FK_OfficeAssignment_Instructor_InstructorID''
	ALTER TABLE dbo.OfficeAssignment DROP CONSTRAINT FK_OfficeAssignment_Instructor_InstructorID;
END 
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('b9b4e2fe-6fff-4875-bc23-0778403e087a' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\1.1.0-Changes\00002_20190913_1112_Refactor_DropForeignKeys.sql", ID: {b9b4e2fe-6fff-4875-bc23-0778403e087a} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('b9b4e2fe-6fff-4875-bc23-0778403e087a' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('b9b4e2fe-6fff-4875-bc23-0778403e087a' AS UNIQUEIDENTIFIER), '919606917FA9FFDF0EFD01762A0A2375509374C01AD52BBC0ACA61CD646A265D', 'Migrations\1.1.0-Changes\00002_20190913_1112_Refactor_DropForeignKeys.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('476241e3-adf4-4ec0-89f2-0113db3e431d' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\1.1.0-Changes\00003_20190913_1114_Refactor_DropTables.sql", ID: {476241e3-adf4-4ec0-89f2-0113db3e431d} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('476241e3-adf4-4ec0-89f2-0113db3e431d' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\1.1.0-Changes\00003_20190913_1114_Refactor_DropTables.sql", ID: {476241e3-adf4-4ec0-89f2-0113db3e431d} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('/**************************************************************************
** CREATED BY:   Mick Letofsky
** CREATED DATE: 2019.09.13
** CREATION:     Refactor effort: Drop tables
**************************************************************************/
DROP TABLE IF EXISTS dbo.__EFMigrationsHistory
DROP TABLE IF EXISTS dbo.Course;
DROP TABLE IF EXISTS dbo.CourseAssignment;
DROP TABLE IF EXISTS dbo.Department;
DROP TABLE IF EXISTS dbo.Instructor;
DROP TABLE IF EXISTS dbo.OfficeAssignment;
DROP TABLE IF EXISTS dbo.Student
DROP TABLE IF EXISTS dbo.Enrollment;
');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('476241e3-adf4-4ec0-89f2-0113db3e431d' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\1.1.0-Changes\00003_20190913_1114_Refactor_DropTables.sql", ID: {476241e3-adf4-4ec0-89f2-0113db3e431d} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('476241e3-adf4-4ec0-89f2-0113db3e431d' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('476241e3-adf4-4ec0-89f2-0113db3e431d' AS UNIQUEIDENTIFIER), '127B611077A72FD1B21C4E1A75CAD2187CA5BDC563785C6BE848D76B47CC9A8F', 'Migrations\1.1.0-Changes\00003_20190913_1114_Refactor_DropTables.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('6a10bb3a-0a0b-4e9d-818e-ce8c88c5c230' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\1.1.0-Changes\00004_20190913_1114_Refactor_ReCreateTables.sql", ID: {6a10bb3a-0a0b-4e9d-818e-ce8c88c5c230} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('6a10bb3a-0a0b-4e9d-818e-ce8c88c5c230' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\1.1.0-Changes\00004_20190913_1114_Refactor_ReCreateTables.sql", ID: {6a10bb3a-0a0b-4e9d-818e-ce8c88c5c230} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('/**************************************************************************
** CREATED BY:   Mick Letofsky
** CREATED DATE: 2019.09.13
** CREATION:     Refactor effort: Re-create tables
**************************************************************************/
CREATE TABLE dbo.Department
(
    DepartmentId INTEGER IDENTITY(1,1) NOT NULL CONSTRAINT UK_Department_DepartmentID UNIQUE CLUSTERED
	,DepartmentGuid UNIQUEIDENTIFIER NOT NULL CONSTRAINT DF_Department_DepartmentGuid DEFAULT NEWSEQUENTIALID()
    ,DepartmentName VARCHAR(100) NOT NULL
    ,DepartmentChairGuid UNIQUEIDENTIFIER NULL 
	,Budget DECIMAL(19, 4) NOT NULL
    ,FoundedDate DATE NOT NULL
	,IsActive BIT NOT NULL CONSTRAINT DF_Department_IsActive DEFAULT (1)
	,RecordVersion TIMESTAMP NULL
	,AuditCreateDateTime DATETIME NOT NULL CONSTRAINT DF_Department_AuditCreateDateTime DEFAULT GETDATE()
	,AuditUpdateDateTime DATETIME NOT NULL CONSTRAINT DF_Department_AuditUpdateDateTime DEFAULT GETDATE()        
    ,CONSTRAINT PK_Department PRIMARY KEY NONCLUSTERED (DepartmentGuid ASC)
)

CREATE TABLE dbo.Course
(
    CourseId INTEGER IDENTITY(1,1) NOT NULL CONSTRAINT UK_Course_CourseGuid UNIQUE CLUSTERED
	,CourseGuid UNIQUEIDENTIFIER NOT NULL CONSTRAINT DF_Course_CourseGuid DEFAULT NEWSEQUENTIALID()
	,DepartmentGuid UNIQUEIDENTIFIER NOT NULL 
	,Title VARCHAR(100) NULL
    ,Credits INTEGER NOT NULL
	,IsActive BIT NOT NULL CONSTRAINT DF_Course_IsActive DEFAULT (1)
	,RecordVersion TIMESTAMP NULL
	,AuditCreateDateTime DATETIME NOT NULL CONSTRAINT DF_Course_AuditCreateDateTime DEFAULT GETDATE()
	,AuditUpdateDateTime DATETIME NOT NULL CONSTRAINT DF_Course_AuditUpdateDateTime DEFAULT GETDATE()        
    ,CONSTRAINT PK_Course PRIMARY KEY NONCLUSTERED (CourseGuid ASC)
)

CREATE TABLE dbo.Instructor
(
	InstructorId INTEGER IDENTITY(1,1) NOT NULL CONSTRAINT UK_Instructor_InstructorGuid UNIQUE CLUSTERED
	,InstructorGuid UNIQUEIDENTIFIER NOT NULL CONSTRAINT DF_Instructor_InstructorGuid DEFAULT NEWSEQUENTIALID()
	,Prefix VARCHAR(25) NULL
	,FirstName VARCHAR(100) NOT NULL
    ,MiddleName VARCHAR(100) NULL
	,LastName VARCHAR(100) NOT NULL
    ,Suffix VARCHAR(25) NULL
    ,DateOfBirth DATE NULL
    ,HireDate DATE NOT NULL
	,OfficeLocation VARCHAR(50) NULL
	,IsActive BIT NOT NULL CONSTRAINT DF_Instructor_IsActive DEFAULT (1)
	,RecordVersion TIMESTAMP NULL
	,AuditCreateDateTime DATETIME NOT NULL CONSTRAINT DF_Instructor_AuditCreateDateTime DEFAULT GETDATE()
	,AuditUpdateDateTime DATETIME NOT NULL CONSTRAINT DF_Instructor_AuditUpdateDateTime DEFAULT GETDATE()
    ,CONSTRAINT PK_Instructor PRIMARY KEY NONCLUSTERED (InstructorGuid ASC)
)

CREATE TABLE dbo.Student
(    
	StudentId INTEGER IDENTITY(1,1) NOT NULL CONSTRAINT UK_Student_StudentId UNIQUE CLUSTERED
	,StudentGuid UNIQUEIDENTIFIER NOT NULL CONSTRAINT DF_Student_StudentGuid DEFAULT NEWSEQUENTIALID()
	,Prefix VARCHAR(25) NULL
	,FirstName VARCHAR(100) NOT NULL
    ,MiddleName VARCHAR(100) NULL
	,LastName VARCHAR(100) NOT NULL
    ,Suffix VARCHAR(25) NULL
    ,DateOfBirth DATE NULL
	,EnrollmentDate DATE NOT NULL
	,IsActive BIT NOT NULL CONSTRAINT DF_Student_IsActive DEFAULT (1)
	,RecordVersion TIMESTAMP NULL
	,AuditCreateDateTime DATETIME NOT NULL CONSTRAINT DF_Student_AuditCreateDateTime DEFAULT GETDATE()
	,AuditUpdateDateTime DATETIME NOT NULL CONSTRAINT DF_Student_AuditUpdateDateTime DEFAULT GETDATE()
    ,CONSTRAINT PK_Student PRIMARY KEY NONCLUSTERED (StudentGuid ASC)
)

CREATE TABLE dbo.Enrollment
(
    EnrollmentId INTEGER IDENTITY(1, 1) NOT NULL CONSTRAINT UK_Enrollment_EnrollmentId UNIQUE CLUSTERED
	,EnrollmentGuid UNIQUEIDENTIFIER NOT NULL CONSTRAINT DF_Enrollment_EnrollmentGuid DEFAULT NEWSEQUENTIALID()
    ,CourseGuid UNIQUEIDENTIFIER NOT NULL
    ,StudentGuid UNIQUEIDENTIFIER NOT NULL 
    ,Grade INTEGER NULL
	,IsActive BIT NOT NULL CONSTRAINT DF_Enrollment_IsActive DEFAULT (1)
	,RecordVersion TIMESTAMP NULL
	,AuditCreateDateTime DATETIME NOT NULL CONSTRAINT DF_Enrollment_AuditCreateDateTime DEFAULT GETDATE()
	,AuditUpdateDateTime DATETIME NOT NULL CONSTRAINT DF_Enrollment_AuditUpdateDateTime DEFAULT GETDATE()
    ,CONSTRAINT PK_Enrollment PRIMARY KEY NONCLUSTERED (EnrollmentGuid ASC)
)

CREATE TABLE dbo.CourseAssignment
(
    InstructorGuid UNIQUEIDENTIFIER NOT NULL
    ,CourseGuid UNIQUEIDENTIFIER NOT NULL
	,IsActive BIT NOT NULL CONSTRAINT DF_CourseAssignment_IsActive DEFAULT (1)
	,RecordVersion TIMESTAMP NULL
	,AuditCreateDateTime DATETIME NOT NULL CONSTRAINT DF_CourseAssignment_AuditCreateDateTime DEFAULT GETDATE()
	,AuditUpdateDateTime DATETIME NOT NULL CONSTRAINT DF_CourseAssignment_AuditUpdateDateTime DEFAULT GETDATE()
    ,CONSTRAINT PK_CourseAssignment PRIMARY KEY CLUSTERED (CourseGuid ASC, InstructorGuid ASC)
);');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('6a10bb3a-0a0b-4e9d-818e-ce8c88c5c230' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\1.1.0-Changes\00004_20190913_1114_Refactor_ReCreateTables.sql", ID: {6a10bb3a-0a0b-4e9d-818e-ce8c88c5c230} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('6a10bb3a-0a0b-4e9d-818e-ce8c88c5c230' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('6a10bb3a-0a0b-4e9d-818e-ce8c88c5c230' AS UNIQUEIDENTIFIER), '155C60CDD8E111A9D4199B307DF2CD9CD9A53BA14BAC711ACF22E98C1A9066DE', 'Migrations\1.1.0-Changes\00004_20190913_1114_Refactor_ReCreateTables.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('e7519d53-56fe-4307-ac33-9cdc873f0123' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\1.1.0-Changes\00005_20190913_1115_InsertData.sql", ID: {e7519d53-56fe-4307-ac33-9cdc873f0123} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('e7519d53-56fe-4307-ac33-9cdc873f0123' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\1.1.0-Changes\00005_20190913_1115_InsertData.sql", ID: {e7519d53-56fe-4307-ac33-9cdc873f0123} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('/**************************************************************************
** CREATED BY:   Mick Letofsky
** CREATED DATE: 2019.09.13
** CREATION:     Refactor effort: Insert Data
**************************************************************************/
INSERT INTO dbo.Department (DepartmentGuid,DepartmentName,Budget,FoundedDate)VALUES(''F60D906A-3FD6-E911-B7F0-989096C0B27B'',''English'',350000.0000,''2007-05-01'');
INSERT INTO dbo.Department (DepartmentGuid,DepartmentName,Budget,FoundedDate)VALUES(''F70D906A-3FD6-E911-B7F0-989096C0B27B'',''Mathematics'',100000.0000,''2007-05-02'');
INSERT INTO dbo.Department (DepartmentGuid,DepartmentName,Budget,FoundedDate)VALUES(''F80D906A-3FD6-E911-B7F0-989096C0B27B'',''Engineering'',350000.0000,''2007-05-03'');
INSERT INTO dbo.Department (DepartmentGuid,DepartmentName,Budget,FoundedDate)VALUES(''F90D906A-3FD6-E911-B7F0-989096C0B27B'',''Economics'',100000.0000,''2007-05-04'');
INSERT INTO dbo.Department (DepartmentGuid,DepartmentName,Budget,FoundedDate)VALUES(''FA0D906A-3FD6-E911-B7F0-989096C0B27B'',''History'',100000.0000,''2007-05-05'');
INSERT INTO dbo.Department (DepartmentGuid,DepartmentName,Budget,FoundedDate)VALUES(''FB0D906A-3FD6-E911-B7F0-989096C0B27B'',''Accounting'',100000.0000,''2007-05-06'');
INSERT INTO dbo.Department (DepartmentGuid,DepartmentName,Budget,FoundedDate)VALUES(''FC0D906A-3FD6-E911-B7F0-989096C0B27B'',''Computer Science'',100000.0000,''2007-05-07'');
INSERT INTO dbo.Department (DepartmentGuid,DepartmentName,Budget,FoundedDate)VALUES(''FD0D906A-3FD6-E911-B7F0-989096C0B27B'',''Religious Studies'',100000.0000,''2007-05-08'');
INSERT INTO dbo.Department (DepartmentGuid,DepartmentName,Budget,FoundedDate)VALUES(''FE0D906A-3FD6-E911-B7F0-989096C0B27B'',''Environmental Science'',100000.0000,''2007-05-09'');
INSERT INTO dbo.Department (DepartmentGuid,DepartmentName,Budget,FoundedDate)VALUES(''FF0D906A-3FD6-E911-B7F0-989096C0B27B'',''Performing Arts'',100000.0000,''2007-05-10'');

INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''19138F58-42D6-E911-B7F0-989096C0B27B'',''F70D906A-3FD6-E911-B7F0-989096C0B27B'',''Precalculus'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''1A138F58-42D6-E911-B7F0-989096C0B27B'',''F70D906A-3FD6-E911-B7F0-989096C0B27B'',''Calculus I'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''1B138F58-42D6-E911-B7F0-989096C0B27B'',''F70D906A-3FD6-E911-B7F0-989096C0B27B'',''Calculus II'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''1C138F58-42D6-E911-B7F0-989096C0B27B'',''F70D906A-3FD6-E911-B7F0-989096C0B27B'',''Linear Algebra'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''1D138F58-42D6-E911-B7F0-989096C0B27B'',''F70D906A-3FD6-E911-B7F0-989096C0B27B'',''Abstract Algebra'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''1E138F58-42D6-E911-B7F0-989096C0B27B'',''F70D906A-3FD6-E911-B7F0-989096C0B27B'',''Discrete Mathematics'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''1F138F58-42D6-E911-B7F0-989096C0B27B'',''F70D906A-3FD6-E911-B7F0-989096C0B27B'',''Number Theory'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''20138F58-42D6-E911-B7F0-989096C0B27B'',''F70D906A-3FD6-E911-B7F0-989096C0B27B'',''Trigonometry'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''21138F58-42D6-E911-B7F0-989096C0B27B'',''F70D906A-3FD6-E911-B7F0-989096C0B27B'',''Geometry'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''22138F58-42D6-E911-B7F0-989096C0B27B'',''F70D906A-3FD6-E911-B7F0-989096C0B27B'',''Statistics'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''23138F58-42D6-E911-B7F0-989096C0B27B'',''F60D906A-3FD6-E911-B7F0-989096C0B27B'',''Composition'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''24138F58-42D6-E911-B7F0-989096C0B27B'',''F60D906A-3FD6-E911-B7F0-989096C0B27B'',''Creative Writing'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''25138F58-42D6-E911-B7F0-989096C0B27B'',''F60D906A-3FD6-E911-B7F0-989096C0B27B'',''English Grammar'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''26138F58-42D6-E911-B7F0-989096C0B27B'',''F60D906A-3FD6-E911-B7F0-989096C0B27B'',''Literary Theory'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''27138F58-42D6-E911-B7F0-989096C0B27B'',''F90D906A-3FD6-E911-B7F0-989096C0B27B'',''Principles of Microeconomics I'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''28138F58-42D6-E911-B7F0-989096C0B27B'',''F90D906A-3FD6-E911-B7F0-989096C0B27B'',''Principles of Macroeconomics II'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''29138F58-42D6-E911-B7F0-989096C0B27B'',''F90D906A-3FD6-E911-B7F0-989096C0B27B'',''Principles of Microeconomics I'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''2A138F58-42D6-E911-B7F0-989096C0B27B'',''F90D906A-3FD6-E911-B7F0-989096C0B27B'',''Principles of Microeconomics II'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''2B138F58-42D6-E911-B7F0-989096C0B27B'',''FC0D906A-3FD6-E911-B7F0-989096C0B27B'',''Introduction to Data Structures'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''2C138F58-42D6-E911-B7F0-989096C0B27B'',''FC0D906A-3FD6-E911-B7F0-989096C0B27B'',''Object-oriented Programming'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''2D138F58-42D6-E911-B7F0-989096C0B27B'',''FC0D906A-3FD6-E911-B7F0-989096C0B27B'',''Principles of Programming Languages'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''2E138F58-42D6-E911-B7F0-989096C0B27B'',''FC0D906A-3FD6-E911-B7F0-989096C0B27B'',''Theory of Computing'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''2F138F58-42D6-E911-B7F0-989096C0B27B'',''FA0D906A-3FD6-E911-B7F0-989096C0B27B'',''American Civilization'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''30138F58-42D6-E911-B7F0-989096C0B27B'',''FA0D906A-3FD6-E911-B7F0-989096C0B27B'',''World History'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''31138F58-42D6-E911-B7F0-989096C0B27B'',''FB0D906A-3FD6-E911-B7F0-989096C0B27B'',''Financial Accounting'',3);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''32138F58-42D6-E911-B7F0-989096C0B27B'',''FB0D906A-3FD6-E911-B7F0-989096C0B27B'',''Managerial Accounting'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''33138F58-42D6-E911-B7F0-989096C0B27B'',''FB0D906A-3FD6-E911-B7F0-989096C0B27B'',''Accounting Systems'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''34138F58-42D6-E911-B7F0-989096C0B27B'',''FF0D906A-3FD6-E911-B7F0-989096C0B27B'',''Theatre History'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''35138F58-42D6-E911-B7F0-989096C0B27B'',''FF0D906A-3FD6-E911-B7F0-989096C0B27B'',''Musical Theatre'',4);
INSERT INTO dbo.Course (CourseGuid,DepartmentGuid,Title,Credits)VALUES(''36138F58-42D6-E911-B7F0-989096C0B27B'',''FF0D906A-3FD6-E911-B7F0-989096C0B27B'',''Dramatic Literature'',4);

INSERT INTO dbo.Instructor (InstructorGuid,Prefix,LastName,FirstName,HireDate)VALUES(''4AF112CE-3BD6-E911-B7F0-989096C0B27B'',''Mrs.'',''Abercrombiess'',''Kim'',''2017-03-11'');
INSERT INTO dbo.Instructor (InstructorGuid,Prefix,LastName,FirstName,HireDate)VALUES(''4BF112CE-3BD6-E911-B7F0-989096C0B27B'',''Ms'',''Fakhouri'',''Fadi'',''2017-07-06'');
INSERT INTO dbo.Instructor (InstructorGuid,Prefix,LastName,FirstName,HireDate)VALUES(''4CF112CE-3BD6-E911-B7F0-989096C0B27B'',''Mr.'',''Harui'',''Roger'',''2017-07-01'');
INSERT INTO dbo.Instructor (InstructorGuid,Prefix,LastName,FirstName,HireDate)VALUES(''4DF112CE-3BD6-E911-B7F0-989096C0B27B'',''Mrs.'',''Kapoor'',''Candace'',''2017-01-15'');
INSERT INTO dbo.Instructor (InstructorGuid,Prefix,LastName,FirstName,HireDate)VALUES(''4EF112CE-3BD6-E911-B7F0-989096C0B27B'',''Mr.'',''Zheng'',''Roger'',''2017-02-12'');
INSERT INTO dbo.Instructor (InstructorGuid,Prefix,LastName,FirstName,HireDate)VALUES(''4FF112CE-3BD6-E911-B7F0-989096C0B27B'',''Mr.'',''Ruth'',''Babe'',''2017-02-08'');
INSERT INTO dbo.Instructor (InstructorGuid,Prefix,LastName,FirstName,HireDate)VALUES(''50F112CE-3BD6-E911-B7F0-989096C0B27B'',''Mr.'',''Mantle'',''Mickey'',''2017-02-10'');

INSERT INTO dbo.CourseAssignment (InstructorGuid,CourseGuid)VALUES(''4AF112CE-3BD6-E911-B7F0-989096C0B27B'',''19138F58-42D6-E911-B7F0-989096C0B27B'');
INSERT INTO dbo.CourseAssignment (InstructorGuid,CourseGuid)VALUES(''4AF112CE-3BD6-E911-B7F0-989096C0B27B'',''1A138F58-42D6-E911-B7F0-989096C0B27B'');
INSERT INTO dbo.CourseAssignment (InstructorGuid,CourseGuid)VALUES(''4BF112CE-3BD6-E911-B7F0-989096C0B27B'',''27138F58-42D6-E911-B7F0-989096C0B27B'');
INSERT INTO dbo.CourseAssignment (InstructorGuid,CourseGuid)VALUES(''4BF112CE-3BD6-E911-B7F0-989096C0B27B'',''28138F58-42D6-E911-B7F0-989096C0B27B'');
INSERT INTO dbo.CourseAssignment (InstructorGuid,CourseGuid)VALUES(''4BF112CE-3BD6-E911-B7F0-989096C0B27B'',''29138F58-42D6-E911-B7F0-989096C0B27B'');
INSERT INTO dbo.CourseAssignment (InstructorGuid,CourseGuid)VALUES(''4DF112CE-3BD6-E911-B7F0-989096C0B27B'',''34138F58-42D6-E911-B7F0-989096C0B27B'');
INSERT INTO dbo.CourseAssignment (InstructorGuid,CourseGuid)VALUES(''4DF112CE-3BD6-E911-B7F0-989096C0B27B'',''35138F58-42D6-E911-B7F0-989096C0B27B'');
INSERT INTO dbo.CourseAssignment (InstructorGuid,CourseGuid)VALUES(''4DF112CE-3BD6-E911-B7F0-989096C0B27B'',''36138F58-42D6-E911-B7F0-989096C0B27B'');

INSERT INTO dbo.Student (StudentGuid,Prefix,LastName,FirstName,EnrollmentDate,DateOfBirth)VALUES(''AAE2F718-37D6-E911-B7F0-989096C0B27B'',''Mr.'',''Alexander'',''Carson'',''2018-09-01'', ''2000-01-01'');
INSERT INTO dbo.Student (StudentGuid,Prefix,LastName,FirstName,EnrollmentDate,DateOfBirth)VALUES(''ABE2F718-37D6-E911-B7F0-989096C0B27B'',''Ms.'',''Alonso'',''Meredith'',''2018-09-01'', ''2000-01-02'');
INSERT INTO dbo.Student (StudentGuid,Prefix,LastName,FirstName,EnrollmentDate,DateOfBirth)VALUES(''ACE2F718-37D6-E911-B7F0-989096C0B27B'',''Mr.'',''Anand'',''Arturo'',''2018-09-01'', ''2000-01-03'');
INSERT INTO dbo.Student (StudentGuid,Prefix,LastName,FirstName,EnrollmentDate,DateOfBirth)VALUES(''ADE2F718-37D6-E911-B7F0-989096C0B27B'',''Mr.'',''Barzdukas'',''Gytis'',''2018-09-01'', ''2000-01-04'');
INSERT INTO dbo.Student (StudentGuid,Prefix,LastName,FirstName,EnrollmentDate,DateOfBirth)VALUES(''AEE2F718-37D6-E911-B7F0-989096C0B27B'',''Miss'',''Li'',''Yan'',''2018-09-01'', ''2000-01-05'');
INSERT INTO dbo.Student (StudentGuid,Prefix,LastName,FirstName,EnrollmentDate,DateOfBirth)VALUES(''AFE2F718-37D6-E911-B7F0-989096C0B27B'',''Ms.'',''Justice'',''Peggy'',''2018-09-01'', ''2000-01-06'');
INSERT INTO dbo.Student (StudentGuid,Prefix,LastName,FirstName,EnrollmentDate,DateOfBirth)VALUES(''B0E2F718-37D6-E911-B7F0-989096C0B27B'',''Mrs.'',''Norman'',''Laura'',''2018-09-01'', ''2000-01-07'');
INSERT INTO dbo.Student (StudentGuid,Prefix,LastName,FirstName,EnrollmentDate,DateOfBirth)VALUES(''B1E2F718-37D6-E911-B7F0-989096C0B27B'',''Mr.'',''Olivetto'',''Nino'',''2018-09-01'', ''2000-01-08'');

INSERT INTO dbo.Enrollment (CourseGuid,StudentGuid,Grade)VALUES(''19138F58-42D6-E911-B7F0-989096C0B27B'',''AAE2F718-37D6-E911-B7F0-989096C0B27B'',NULL);
INSERT INTO dbo.Enrollment (CourseGuid,StudentGuid,Grade)VALUES(''19138F58-42D6-E911-B7F0-989096C0B27B'',''ACE2F718-37D6-E911-B7F0-989096C0B27B'',2);
INSERT INTO dbo.Enrollment (CourseGuid,StudentGuid,Grade)VALUES(''19138F58-42D6-E911-B7F0-989096C0B27B'',''ADE2F718-37D6-E911-B7F0-989096C0B27B'',1);
INSERT INTO dbo.Enrollment (CourseGuid,StudentGuid,Grade)VALUES(''27138F58-42D6-E911-B7F0-989096C0B27B'',''ABE2F718-37D6-E911-B7F0-989096C0B27B'',1);
INSERT INTO dbo.Enrollment (CourseGuid,StudentGuid,Grade)VALUES(''27138F58-42D6-E911-B7F0-989096C0B27B'',''ADE2F718-37D6-E911-B7F0-989096C0B27B'',1);
INSERT INTO dbo.Enrollment (CourseGuid,StudentGuid,Grade)VALUES(''29138F58-42D6-E911-B7F0-989096C0B27B'',''AFE2F718-37D6-E911-B7F0-989096C0B27B'',1);
INSERT INTO dbo.Enrollment (CourseGuid,StudentGuid,Grade)VALUES(''29138F58-42D6-E911-B7F0-989096C0B27B'',''AAE2F718-37D6-E911-B7F0-989096C0B27B'',NULL);
INSERT INTO dbo.Enrollment (CourseGuid,StudentGuid,Grade)VALUES(''34138F58-42D6-E911-B7F0-989096C0B27B'',''ACE2F718-37D6-E911-B7F0-989096C0B27B'',1);
INSERT INTO dbo.Enrollment (CourseGuid,StudentGuid,Grade)VALUES(''34138F58-42D6-E911-B7F0-989096C0B27B'',''AAE2F718-37D6-E911-B7F0-989096C0B27B'',1);
INSERT INTO dbo.Enrollment (CourseGuid,StudentGuid,Grade)VALUES(''34138F58-42D6-E911-B7F0-989096C0B27B'',''AFE2F718-37D6-E911-B7F0-989096C0B27B'',1);
INSERT INTO dbo.Enrollment (CourseGuid,StudentGuid,Grade)VALUES(''34138F58-42D6-E911-B7F0-989096C0B27B'',''AFE2F718-37D6-E911-B7F0-989096C0B27B'',1);

');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('e7519d53-56fe-4307-ac33-9cdc873f0123' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\1.1.0-Changes\00005_20190913_1115_InsertData.sql", ID: {e7519d53-56fe-4307-ac33-9cdc873f0123} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('e7519d53-56fe-4307-ac33-9cdc873f0123' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('e7519d53-56fe-4307-ac33-9cdc873f0123' AS UNIQUEIDENTIFIER), 'FF09FE73A77924FF4D4B6A4C3101851FE550DAA5B3BBED8DF489DA2E9E2969B4', 'Migrations\1.1.0-Changes\00005_20190913_1115_InsertData.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('c52c0d04-b8d8-495c-8915-b1d51da34f79' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\1.1.0-Changes\00006_20190913_1116_ReAddForeignKeys.sql", ID: {c52c0d04-b8d8-495c-8915-b1d51da34f79} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('c52c0d04-b8d8-495c-8915-b1d51da34f79' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\1.1.0-Changes\00006_20190913_1116_ReAddForeignKeys.sql", ID: {c52c0d04-b8d8-495c-8915-b1d51da34f79} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('/**************************************************************************
** CREATED BY:   Mick Letofsky
** CREATED DATE: 2019.09.13
** CREATION:     Refactor effort: Re-Add Foreign Keys
**************************************************************************/
ALTER TABLE dbo.Course WITH CHECK
ADD CONSTRAINT FK_Course_Department FOREIGN KEY (DepartmentGuid) REFERENCES dbo.Department (DepartmentGuid);
ALTER TABLE dbo.Course CHECK CONSTRAINT FK_Course_Department;

ALTER TABLE dbo.CourseAssignment WITH CHECK
ADD CONSTRAINT FK_CourseAssignment_Course FOREIGN KEY (CourseGuid) REFERENCES dbo.Course (CourseGuid);
ALTER TABLE dbo.CourseAssignment CHECK CONSTRAINT FK_CourseAssignment_Course;

ALTER TABLE dbo.CourseAssignment WITH CHECK
ADD CONSTRAINT FK_CourseAssignment_Instructor FOREIGN KEY (InstructorGuid) REFERENCES dbo.Instructor (InstructorGuid);
ALTER TABLE dbo.CourseAssignment CHECK CONSTRAINT FK_CourseAssignment_Instructor;

ALTER TABLE dbo.Department WITH CHECK
ADD CONSTRAINT FK_Department_Instructor FOREIGN KEY (DepartmentChairGuid) REFERENCES dbo.Instructor (InstructorGuid);
ALTER TABLE dbo.Department CHECK CONSTRAINT FK_Department_Instructor;

ALTER TABLE dbo.Enrollment  WITH CHECK 
ADD CONSTRAINT FK_Enrollment_Course FOREIGN KEY(CourseGuid) REFERENCES dbo.Course (CourseGuid)
ALTER TABLE dbo.Enrollment CHECK CONSTRAINT FK_Enrollment_Course

ALTER TABLE dbo.Enrollment WITH CHECK
ADD CONSTRAINT FK_Enrollment_Student FOREIGN KEY (StudentGuid) REFERENCES dbo.Student (StudentGuid);
ALTER TABLE dbo.Enrollment CHECK CONSTRAINT FK_Enrollment_Student;

');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('c52c0d04-b8d8-495c-8915-b1d51da34f79' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\1.1.0-Changes\00006_20190913_1116_ReAddForeignKeys.sql", ID: {c52c0d04-b8d8-495c-8915-b1d51da34f79} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('c52c0d04-b8d8-495c-8915-b1d51da34f79' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('c52c0d04-b8d8-495c-8915-b1d51da34f79' AS UNIQUEIDENTIFIER), '95F131AB1BF3D07D40B157C0592BB70F78D67DABDB93576C1A88199EFB31D380', 'Migrations\1.1.0-Changes\00006_20190913_1116_ReAddForeignKeys.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;

GO
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('d20e3d47-94bc-483c-ad7f-2f5db3066672' AS UNIQUEIDENTIFIER))
  PRINT '

***** EXECUTING MIGRATION "Migrations\1.1.0-Changes\00007_20190930_1502_MoreDMLForDatabase.sql", ID: {d20e3d47-94bc-483c-ad7f-2f5db3066672} *****';

GO
IF EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('d20e3d47-94bc-483c-ad7f-2f5db3066672' AS UNIQUEIDENTIFIER))
BEGIN
  PRINT '----- Skipping "Migrations\1.1.0-Changes\00007_20190930_1502_MoreDMLForDatabase.sql", ID: {d20e3d47-94bc-483c-ad7f-2f5db3066672} as it has already been run on this database';
  SET NOEXEC ON;
END

GO
EXECUTE ('/**************************************************************************
** CREATED BY:   Mick Letofsky
** CREATED DATE: 2019.09.30
** CREATION:     Adding more data to make the app more fun!
**************************************************************************/
DELETE	c
FROM	dbo.CourseAssignment c
WHERE	EXISTS (SELECT 1 FROM dbo.Instructor i WHERE c.InstructorGuid  = i.InstructorGuid AND InstructorId > 5)

DELETE 
FROM	dbo.Instructor 
WHERE	InstructorId > 5

SET IDENTITY_INSERT dbo.Instructor ON
INSERT INTO dbo.Instructor (InstructorId,InstructorGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,HireDate,OfficeLocation,IsActive)VALUES(6,''4040565A-C701-4EE6-E76C-08D742BC182C'',NULL,''Joseph'',''Vincent'',''McCarthy'',NULL,''1887-04-21'',''2018-08-05'',''Yankee Stadium'',1);
INSERT INTO dbo.Instructor (InstructorId,InstructorGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,HireDate,OfficeLocation,IsActive)VALUES(7,''5C2CD7A0-F28C-4FC7-E76D-08D742BC182C'',NULL,''Connie'',NULL,''Mack'',NULL,''1862-12-22'',''2018-08-01'',''Nationals Park'',1);
INSERT INTO dbo.Instructor (InstructorId,InstructorGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,HireDate,OfficeLocation,IsActive)VALUES(8,''C4964DFF-CB87-4AB2-E76E-08D742BC182C'',NULL,''Casey'',NULL,''Stengel'',NULL,''1890-07-30'',''2018-08-05'',''Yankee Stadium'',1);
INSERT INTO dbo.Instructor (InstructorId,InstructorGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,HireDate,OfficeLocation,IsActive)VALUES(9,''5D848C5C-C06C-4ED2-E76F-08D742BC182C'',NULL,''Sparky'',''Lee'',''Anderson'',NULL,''1934-08-22'',''2018-08-05'',''Riverfront Stadium'',1);
INSERT INTO dbo.Instructor (InstructorId,InstructorGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,HireDate,OfficeLocation,IsActive)VALUES(10,''7F303E6D-1D13-419B-E770-08D742BC182C'',''Mr.'',''Tommy'',''Charles'',''Lasorda'',NULL,''1927-09-22'',''2018-08-05'',''Dodger Stadium'',1);
INSERT INTO dbo.Instructor (InstructorId,InstructorGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,HireDate,OfficeLocation,IsActive)VALUES(11,''A5432254-E60A-4E0F-8B0C-16FB73642AB3'',''Mr.'',''Tony'',NULL,''La Russa'',''Jr.'',''10-04-1944'',''2018-08-01'',''Busch Stadium'',1);
INSERT INTO dbo.Instructor (InstructorId,InstructorGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,HireDate,OfficeLocation,IsActive)VALUES(12,''C861BAD1-E756-4C3A-814A-CEEA4F884BA4'',''Mr.'',''Mike'',NULL,''Scioscia'',NULL,''11-27-1958'',''2018-08-03'',''Angel Stadium'',1);
INSERT INTO dbo.Instructor (InstructorId,InstructorGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,HireDate,OfficeLocation,IsActive)VALUES(13,''34A2CA68-9E36-4DE5-A251-661FC96F4A4E'',''Mr.'',''Joe'',NULL,''Torre'',NULL,''07-18-1940'',''2018-08-02'',''Yankee Stadium'',1);
INSERT INTO dbo.Instructor (InstructorId,InstructorGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,HireDate,OfficeLocation,IsActive)VALUES(14,''A5A6F9B1-5BF0-48D1-8E9A-A04B1FC48287'',''Mr.'',''Bobby'',NULL,''Cox'',NULL,''05-21-1941'',''2018-08-02'',''Turner Field'',1);

SET IDENTITY_INSERT dbo.Instructor OFF

DELETE FROM dbo.Student WHERE StudentId > 10

SET IDENTITY_INSERT dbo.Student ON

INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(11,''B187CDB7-B89A-42B3-4109-08D741C1DD47'',''Mr.'',''Joe'',''Clifford'',''Montana'',NULL,''1956-06-11'',''2019-08-08'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(12,''CFD27D38-718F-4584-410A-08D741C1DD47'',NULL,''Peyton'',''Williams'',''Manning'',NULL,''1976-03-24'',''2019-08-01'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(13,''6CDF522E-3262-4328-410B-08D741C1DD47'',''Mr.'',''Dan'',''Constantine'',''Marino'',NULL,''1961-09-15'',''2019-08-01'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(14,''4C5A325E-771D-4385-410C-08D741C1DD47'',''Mr.'',''Brett'',''Lorenzo'',''Farve'',NULL,''1969-10-10'',''2019-08-02'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(15,''62ECEFFA-73F5-44CA-410D-08D741C1DD47'',''Ms.'',''Diana'',''Lorena'',''Taurasi'',NULL,''1982-06-11'',''2019-08-05'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(16,''59DE0723-24D4-4566-410E-08D741C1DD47'',''Ms.'',''Sue'',''Brigit'',''Bird'',NULL,''1980-10-16'',''2019-08-08'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(17,''3CF1AC1B-00F0-48BD-410F-08D741C1DD47'',''Mrs.'',''Lisa'',NULL,''Leslie'',NULL,''1972-07-07'',''2019-08-10'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(18,''B68D0231-41B1-4EED-4110-08D741C1DD47'',NULL,''Candace'',NULL,''Parker'',NULL,''1986-04-19'',''2019-08-01'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(19,''D2EDEA8B-B31C-48D7-4111-08D741C1DD47'',NULL,''Sheryl'',NULL,''Swoopes'',NULL,''1971-03-25'',''2019-08-15'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(20,''B310ED85-06DD-46EC-4112-08D741C1DD47'',NULL,''Lauren'',NULL,''Jackson'',NULL,''1981-03-11'',''2019-08-05'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(21,''704C42DA-6D40-46C4-322C-08D741C4A701'',''Mr.'',''John'',''Albert'',''Elway'',NULL,''1960-06-28'',''2019-08-12'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(22,''4D0770EE-E330-4811-322D-08D741C4A701'',''Mr.'',''Troy'',''Kenneth'',''Aikman'',NULL,''1966-11-21'',''2019-08-15'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(23,''59960B3D-20AE-498C-322E-08D741C4A701'',NULL,''Steve'',NULL,''Young'',NULL,''1961-10-11'',''2019-08-02'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(24,''080D354E-FFBC-4B2A-322F-08D741C4A701'',NULL,''Kurt'',NULL,''Warner'',NULL,''1971-06-22'',''2019-08-06'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(25,''BD06DB34-9EA4-403F-3230-08D741C4A701'',NULL,''Jim'',''Edward'',''Kelly'',NULL,''1960-02-14'',''2019-08-12'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(26,''4834E6C0-C0EA-4979-3231-08D741C4A701'',''Mr.'',''Eli'',''Nelson'',''Manning'',NULL,''1981-01-03'',''2019-08-01'');
INSERT INTO dbo.Student (StudentId,StudentGuid,Prefix,FirstName,MiddleName,LastName,Suffix,DateOfBirth,EnrollmentDate)VALUES(27,''72D7074B-3F03-420E-3232-08D741C4A701'',NULL,''Drew'',NULL,''Brees'',NULL,''1979-01-15'',''2019-08-08'');

SET IDENTITY_INSERT dbo.Student OFF');

GO
SET NOEXEC OFF;

GO
IF N'$(IsSqlCmdEnabled)' <> N'True'
  SET NOEXEC ON;

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('d20e3d47-94bc-483c-ad7f-2f5db3066672' AS UNIQUEIDENTIFIER))
  PRINT '***** FINISHED EXECUTING MIGRATION "Migrations\1.1.0-Changes\00007_20190930_1502_MoreDMLForDatabase.sql", ID: {d20e3d47-94bc-483c-ad7f-2f5db3066672} *****
';

GO
IF NOT EXISTS (SELECT 1 FROM [$(DatabaseName)].[dbo].[__MigrationLogCurrent] WHERE [migration_id] = CAST ('d20e3d47-94bc-483c-ad7f-2f5db3066672' AS UNIQUEIDENTIFIER))
  INSERT [$(DatabaseName)].[dbo].[__MigrationLog] ([migration_id], [script_checksum], [script_filename], [complete_dt], [applied_by], [deployed], [version], [package_version], [release_version])
  VALUES                                         (CAST ('d20e3d47-94bc-483c-ad7f-2f5db3066672' AS UNIQUEIDENTIFIER), '58788FF578ABC93C97C335C529E24A77050103C0C294F549C2D8650CEF2ED111', 'Migrations\1.1.0-Changes\00007_20190930_1502_MoreDMLForDatabase.sql', SYSDATETIME(), SYSTEM_USER, 1, NULL, '$(PackageVersion)', CASE '$(ReleaseVersion)' WHEN '' THEN NULL ELSE '$(ReleaseVersion)' END);

GO
PRINT '# Committing transaction';

COMMIT TRANSACTION;

GO







------------------------------------------------------------------------------------------------------------------------
------------------------------------------       POST-DEPLOYMENT SCRIPTS      ------------------------------------------
------------------------------------------------------------------------------------------------------------------------

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO

PRINT '----- executing post-deployment script "Post-Deployment\01_Finalize_Deployment.sql" -----';
GO

---------------------- BEGIN POST-DEPLOYMENT SCRIPT: "Post-Deployment\01_Finalize_Deployment.sql" ------------------------
/*
Post-Deployment Script Template
--------------------------------------------------------------------------------------
 This file contains SQL statements that will be appended to the build script.
 Use SQLCMD syntax to include a file in the post-deployment script.
 Example:      :r .\myfile.sql
 Use SQLCMD syntax to reference a variable in the post-deployment script.
 Example:      :setvar TableName MyTable
               SELECT * FROM [$(TableName)]
--------------------------------------------------------------------------------------
*/

GO
----------------------- END POST-DEPLOYMENT SCRIPT: "Post-Deployment\01_Finalize_Deployment.sql" -------------------------

SET IMPLICIT_TRANSACTIONS, NUMERIC_ROUNDABORT OFF;
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, NOCOUNT, QUOTED_IDENTIFIER ON;
IF DB_NAME() != '$(DatabaseName)'
  USE [$(DatabaseName)];

GO


IF SERVERPROPERTY('EngineEdition') != 5 AND HAS_PERMS_BY_NAME(N'sys.xp_logevent', N'OBJECT', N'EXECUTE') = 1
BEGIN
  DECLARE @databaseName AS nvarchar(2048), @eventMessage AS nvarchar(2048)
  SET @databaseName = REPLACE(REPLACE(DB_NAME(), N'\', N'\\'), N'"', N'\"')
  SET @eventMessage = N'Redgate SQL Change Automation: { "deployment": { "description": "Redgate SQL Change Automation deployed $(ReleaseVersion) to ' + @databaseName + N'", "database": "' + @databaseName + N'" }}'
  EXECUTE sys.xp_logevent 55000, @eventMessage
END
PRINT 'Deployment completed successfully.'
GO




SET NOEXEC OFF; -- Resume statement execution if an error occurred within the script pre-amble
